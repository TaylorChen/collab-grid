import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from "react";
import { useGridStore } from "@/stores/gridStore";
import { getWS } from "@/services/websocket";
import FreezePanesDialog from "@/components/Grid/FreezePanesDialog";
export default function TopToolbar({ title, onTitleChange, onTitleBlur, gridId, sheetId }) {
    const [showFileMenu, setShowFileMenu] = useState(false);
    const [showEditMenu, setShowEditMenu] = useState(false);
    const [showFormatMenu, setShowFormatMenu] = useState(false);
    const [showFreezeDialog, setShowFreezeDialog] = useState(false);
    const active = useGridStore((s) => s.active);
    const styles = useGridStore((s) => s.styles);
    const setStyle = useGridStore((s) => s.setStyle);
    function applyStyle(patch) {
        if (!active || !gridId)
            return;
        setStyle(active.row, active.col, patch);
        const socket = getWS();
        socket?.emit("grid:operation", {
            id: crypto.randomUUID?.() || String(Date.now()),
            gridId,
            sheetId: sheetId || 0,
            type: "cell:style",
            payload: { row: active.row, col: active.col, style: { ...styles[`${active.row}:${active.col}`], ...patch } }
        });
    }
    const activeStyle = active ? styles[`${active.row}:${active.col}`] || {} : {};
    return (_jsxs("div", { className: "bg-white border-b border-gray-200 select-none", children: [_jsxs("div", { className: "flex items-center px-4 py-2 border-b border-gray-100", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("div", { className: "font-medium text-blue-600", children: "Collab Grid" }), _jsxs("div", { className: "relative", children: [_jsx("button", { className: "px-3 py-1 hover:bg-gray-100 rounded text-sm", onClick: () => setShowFileMenu(!showFileMenu), children: "\u6587\u4EF6" }), showFileMenu && (_jsxs("div", { className: "absolute top-full left-0 bg-white border border-gray-200 rounded shadow-lg py-1 min-w-[120px] z-50", children: [_jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u65B0\u5EFA" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u6253\u5F00" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u4FDD\u5B58" }), _jsx("div", { className: "border-t border-gray-100 my-1" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u5BFC\u5165" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u5BFC\u51FA" })] }))] }), _jsxs("div", { className: "relative", children: [_jsx("button", { className: "px-3 py-1 hover:bg-gray-100 rounded text-sm", onClick: () => setShowEditMenu(!showEditMenu), children: "\u7F16\u8F91" }), showEditMenu && (_jsxs("div", { className: "absolute top-full left-0 bg-white border border-gray-200 rounded shadow-lg py-1 min-w-[120px] z-50", children: [_jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u64A4\u9500" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u91CD\u505A" }), _jsx("div", { className: "border-t border-gray-100 my-1" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u590D\u5236" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u7C98\u8D34" })] }))] }), _jsxs("div", { className: "relative", children: [_jsx("button", { className: "px-3 py-1 hover:bg-gray-100 rounded text-sm", onClick: () => setShowFormatMenu(!showFormatMenu), children: "\u683C\u5F0F" }), showFormatMenu && (_jsxs("div", { className: "absolute top-full left-0 bg-white border border-gray-200 rounded shadow-lg py-1 min-w-[120px] z-50", children: [_jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u6570\u5B57\u683C\u5F0F" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u6761\u4EF6\u683C\u5F0F" }), _jsx("div", { className: "border-t border-gray-100 my-1" }), _jsx("div", { className: "px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm", children: "\u884C\u548C\u5217" })] }))] })] }), _jsx("div", { className: "flex-1 flex justify-center", children: _jsx("input", { className: "text-center font-medium bg-transparent border-none outline-none hover:bg-gray-50 focus:bg-white focus:border focus:border-blue-300 rounded px-2 py-1 max-w-md", value: title, onChange: (e) => onTitleChange(e.target.value), onBlur: onTitleBlur, placeholder: "\u65E0\u6807\u9898\u8868\u683C" }) }), _jsx("div", { className: "flex items-center gap-2", children: _jsx("button", { className: "w-8 h-8 bg-blue-500 text-white rounded-full text-sm font-medium", children: "U" }) })] }), _jsxs("div", { className: "flex items-center px-4 py-2 gap-1", children: [_jsx("button", { className: "p-1.5 hover:bg-gray-100 rounded", title: "\u64A4\u9500", children: _jsx("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" }) }) }), _jsx("button", { className: "p-1.5 hover:bg-gray-100 rounded", title: "\u91CD\u505A", children: _jsx("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6" }) }) }), _jsx("div", { className: "w-px h-6 bg-gray-300 mx-1" }), _jsxs("select", { className: "border border-gray-300 rounded px-2 py-1 text-sm min-w-[100px]", defaultValue: "Arial", children: [_jsx("option", { value: "Arial", children: "Arial" }), _jsx("option", { value: "\u5FAE\u8F6F\u96C5\u9ED1", children: "\u5FAE\u8F6F\u96C5\u9ED1" }), _jsx("option", { value: "\u5B8B\u4F53", children: "\u5B8B\u4F53" })] }), _jsx("select", { className: "border border-gray-300 rounded px-2 py-1 text-sm w-16", value: activeStyle.fontSize || 12, onChange: (e) => applyStyle({ fontSize: Number(e.target.value) }), children: [9, 10, 11, 12, 14, 16, 18, 20, 24, 28, 32, 36].map(size => (_jsx("option", { value: size, children: size }, size))) }), _jsx("div", { className: "w-px h-6 bg-gray-300 mx-1" }), _jsx("button", { className: `p-1.5 hover:bg-gray-100 rounded font-bold ${activeStyle.bold ? 'bg-gray-200' : ''}`, onClick: () => applyStyle({ bold: !activeStyle.bold }), title: "\u7C97\u4F53", children: "B" }), _jsx("button", { className: "p-1.5 hover:bg-gray-100 rounded italic", title: "\u659C\u4F53", children: "I" }), _jsx("button", { className: "p-1.5 hover:bg-gray-100 rounded underline", title: "\u4E0B\u5212\u7EBF", children: "U" }), _jsx("div", { className: "w-px h-6 bg-gray-300 mx-1" }), _jsx("button", { className: `p-1.5 hover:bg-gray-100 rounded ${activeStyle.align === 'left' ? 'bg-gray-200' : ''}`, onClick: () => applyStyle({ align: 'left' }), title: "\u5DE6\u5BF9\u9F50", children: _jsx("svg", { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 20 20", children: _jsx("path", { fillRule: "evenodd", d: "M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1z", clipRule: "evenodd" }) }) }), _jsx("button", { className: `p-1.5 hover:bg-gray-100 rounded ${activeStyle.align === 'center' ? 'bg-gray-200' : ''}`, onClick: () => applyStyle({ align: 'center' }), title: "\u5C45\u4E2D\u5BF9\u9F50", children: _jsx("svg", { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 20 20", children: _jsx("path", { fillRule: "evenodd", d: "M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm2 4a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm-2 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm2 4a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z", clipRule: "evenodd" }) }) }), _jsx("button", { className: `p-1.5 hover:bg-gray-100 rounded ${activeStyle.align === 'right' ? 'bg-gray-200' : ''}`, onClick: () => applyStyle({ align: 'right' }), title: "\u53F3\u5BF9\u9F50", children: _jsx("svg", { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 20 20", children: _jsx("path", { fillRule: "evenodd", d: "M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm6 4a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1zm-6 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm6 4a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z", clipRule: "evenodd" }) }) }), _jsx("div", { className: "w-px h-6 bg-gray-300 mx-1" }), _jsxs("div", { className: "flex items-center gap-1", children: [_jsxs("button", { className: "p-1.5 hover:bg-gray-100 rounded relative", title: "\u6587\u5B57\u989C\u8272", children: [_jsx("svg", { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 20 20", children: _jsx("path", { fillRule: "evenodd", d: "M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z", clipRule: "evenodd" }) }), _jsx("div", { className: "absolute bottom-0 left-1/2 transform -translate-x-1/2 w-3 h-1 bg-red-500" }), _jsx("input", { type: "color", className: "absolute inset-0 opacity-0 cursor-pointer", value: activeStyle.color || '#000000', onChange: (e) => applyStyle({ color: e.target.value }) })] }), _jsxs("button", { className: "p-1.5 hover:bg-gray-100 rounded relative", title: "\u80CC\u666F\u989C\u8272", children: [_jsx("svg", { className: "w-4 h-4", fill: "currentColor", viewBox: "0 0 20 20", children: _jsx("path", { fillRule: "evenodd", d: "M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z", clipRule: "evenodd" }) }), _jsx("div", { className: "absolute bottom-0 left-1/2 transform -translate-x-1/2 w-3 h-1 bg-yellow-400" }), _jsx("input", { type: "color", className: "absolute inset-0 opacity-0 cursor-pointer", value: activeStyle.bg || '#ffffff', onChange: (e) => applyStyle({ bg: e.target.value }) })] })] }), _jsx("div", { className: "w-px h-6 bg-gray-300 mx-1" }), _jsx("button", { className: "p-1.5 hover:bg-gray-100 rounded", title: "\u8FB9\u6846", children: _jsx("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 6h16M4 12h16M4 18h16" }) }) }), _jsx("button", { className: "p-1.5 hover:bg-gray-100 rounded", title: "\u5408\u5E76\u5355\u5143\u683C", children: _jsx("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M4 8V4a1 1 0 011-1h4m0 0h4m-4 0v4m8-4h4a1 1 0 011 1v4m0 0v4m0-4h-4m4 4v4a1 1 0 01-1 1h-4m0 0h-4m4 0v-4m-8 4H5a1 1 0 01-1-1v-4m0 0V8" }) }) }), _jsx("div", { className: "w-px h-6 bg-gray-300 mx-1" }), _jsx("button", { className: "p-1.5 hover:bg-gray-100 rounded", title: "\u51BB\u7ED3\u7A97\u683C", onClick: () => setShowFreezeDialog(true), children: _jsx("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" }) }) })] }), _jsx(FreezePanesDialog, { isOpen: showFreezeDialog, onClose: () => setShowFreezeDialog(false) })] }));
}
